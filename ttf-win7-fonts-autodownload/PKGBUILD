# Maintainer: Damian Nowak <damian.nowak@atlashost.eu>
# Contributor: Martin Schm√∂lzer <mschmoelzer@gmail.com>

# Fork of https://aur.archlinux.org/packages/ttf-win7-fonts/

pkgname='ttf-win7-fonts-autodownload'
pkgver='7.1'
pkgrel='2'
pkgdesc="Microsoft Windows 7 TrueType Fonts (autodownloaded from various places)"
arch=('any')
url="http://www.microsoft.com"
license=('custom')
depends=('fontconfig' 'xorg-mkfontscale' 'xorg-mkfontdir')
makedepends=('fontforge' 'cabextract' 'unzip' 'convmv')
provides=('ttf-vista-fonts' 'ttf-ms-fonts' 'ttf-win7-fonts')
conflicts=('ttf-vista-fonts' 'ttf-ms-fonts' 'ttf-win7-fonts')
install="$pkgname.install"
DLAGENTS+=('fontsupply::/usr/bin/curl -e "http://www.fontsupply.com/" -A "Firefox" -fLC - --retry 3 --retry-delay 3 -o %o `echo "%u" | sed -r "s#fontsupply://(.+)\/(.+)#http://www.fontsupply.com/dl.php?fid=\1\&submitter=Download+The+Font++\2#"` ')
source=('fontsupply://7982/Arial.zip'
        'fontsupply://480/Arialbd.zip'
        'fontsupply://5768/Arialbi.zip'
        'fontsupply://6530/Ariali.zip'
        'fontsupply://5756/Ariblk.zip'
        'fontsupply://10704/Comic.zip'
        'fontsupply://1191/Comicbd.zip'
        'fontsupply://795/Cour.zip'
        'fontsupply://6204/Courbd.zip'
        'fontsupply://6922/Courbi.zip'
        'fontsupply://10985/Couri.zip'
        'fontsupply://3974/Georgia.zip'
        'fontsupply://8463/Georgiab.zip'
        'fontsupply://1906/Georgiai.zip'
        'fontsupply://6152/Georgiaz.zip'
        'fontsupply://9417/Impact.zip'
        'fontsupply://4202/Symbol.zip'
        'fontsupply://4647/Times.zip'
        'fontsupply://5656/Timesbd.zip'
        'fontsupply://1064/Timesbi.zip'
        'fontsupply://3224/Timesi.zip'
        'fontsupply://5567/Trebuc.zip'
        'fontsupply://1046/Trebucbd.zip'
        'fontsupply://2339/Trebucbi.zip'
        'fontsupply://6387/Trebucit.zip'
        'fontsupply://7927/Verdana.zip'
        'fontsupply://3155/Verdanab.zip'
        'fontsupply://7937/Verdanai.zip'
        'fontsupply://1393/Verdanaz.zip'
        'fontsupply://10389/Webdings.zip'
        'fontsupply://4108/Wingding.zip'
        'http://www.cufonfonts.com/downloadFont/12048/calibri.zip'
        'http://www.cufonfonts.com/downloadFont/12050/candara.zip'
        'http://www.cufonfonts.com/downloadFont/12051/corbel.zip'
        'https://github.com/jondot/dotfiles/raw/master/.fonts/constan.ttf'
        'https://github.com/jondot/dotfiles/raw/master/.fonts/constanb.ttf'
        'https://github.com/jondot/dotfiles/raw/master/.fonts/constani.ttf'
        'https://github.com/jondot/dotfiles/raw/master/.fonts/constanz.ttf'
        'http://dl.dropbox.com/u/3395784/aur/ttf-microsoft-consolas/ttf-microsoft-consolas.tar.xz' # from aur/ttf-microsoft-consolas
        'http://download.microsoft.com/download/0/A/F/0AFB5316-3062-494A-AB78-7FB0D4461357/windows6.1-KB976932-X64.exe'
        'license.rtf')
noextract=(${source[@]##*/})
sha256sums=('c77a77d6583d4f7ab0992a45340438ef5100a892358de9868a0ce105ecf1c5d8'
            '64a2508e92b4ff723d72cc6f2be04daca9b2b4db887f92bdbd0946590e4a2158'
            'e350e6a1e8ea916d6af7c8fedf4158fb9b14e56140ed71115314291744671467'
            'fa15ea5c8187826e166bb54595a12acfb0a08d7868a841f38e28773a8740afd8'
            'b8f81e8b174737b232401fb11d9dde02aa0bd29d1b52e426d9c784bc0ff80cae'
            '5ef92d55dea3a743678f9f0eac94987482c042c3e6aad87499b8301d2680ea12'
            '0aefcddf5816cfbf266b8823ee00859ef12dc543d9b9ca7d64d44bfeeeb27270'
            'a730e78904e4ced7b00bac5dcdeffbd7e29b519730bb37ce30587427fceedb90'
            '6883d9d29c9b3de7d871d3733af6be0c0154daed004d318582238b2f820efe13'
            'd53240141fe603b9db4c5e3b33e0ef30e9aa6d21475f054e00c63d4f2a6f7fed'
            '71015f5c009e791281a93cb22ad45bf7aea2d2cbe2da06dc7803d53cd4297132'
            '18053093b04ab161a564d648a35b9e8e5147ecbf8c9a0ff7d16392b97fa9c7df'
            '68b4c635ba014bcac245fccd6c7a1909a8eff9a72032cce4bf15fe43362f2a9d'
            '1fa94b371fc85f0e2ed565589aa97095252607eda2c7154d6d408317adc9aacb'
            'cf9c9a2929ef85e9fe67b1afe3d43aaad908aab7243ef0182284218a940e8438'
            'a66e0e3ab25b82a9f2a0fe1bf11b90eb0378c7b5a17708f24b8309499b3f2e18'
            '18978ee5e4c319cd9511b452212cce910414a5f88fadfb98cb2502af5b655501'
            '0fb1a3078b85c5680e736a853249507acf79ff358a06d40bfd47527ac5f0c725'
            '74175df596c08db4b62bdcba964a39edf4171e875220f8cddc59b05d4f64324b'
            '8cafba0a7a45e1004087be1da01b4357940afdb61e95bb93d0cae34e3b08669f'
            '91730d034383e10acfabb4ccfe3cee8f38b15ee2e5c9ebe87616911df3f90d54'
            '97347afc6b83a8d4026f5774f2b3a354bc2443615cbce19954bfd5de788cb95c'
            '033ad5c16dde86251907b197bf678592149042cfe6c68ee2305013f9c082f969'
            'a8ddadf339e3bc8c1d558510778d45297f8c7baaffd99fb9de602e2593e75346'
            'e30545d426b4540d56f099356b00e743d0bcfcc68bf5fc6cf61b1ce31a03dab3'
            '59de3903cdf79f6d616141eee64f1ac49785de9e63344f57cc663a3d7d51f6cf'
            'e7e2fa694d18c971530af7e8b2dda234f28480aa4c6e0f706ff2e80ca2d4d456'
            'a3e1dcc6fb82ecaa0b43c685b1ea7f7399dbef8dc3948667c23edc888c360306'
            'fe06578063611a2de20779cfd3a01a5ce0e3b30740154dc29927d7b66d5a83d5'
            'b54baf85567770e9e6c68188dc47f615e75b02ebb8c7b4c52b8e28357f9fdf74'
            '429ab00a9329085a82f8143e37af24390fdd50c7b8baa0635306aafb76146221'
            '49f7e8c1c492e9790addb9d5f224811896019de9a7627e2d3f67fe47a444b5cb'
            '00135f0eabb158d350037fcb0534f96695cd0a80c5f83989618cb4849ff4bc41'
            'a7c8df9615d44d97eb1e40bb2e76b130beb628946e353aee4107203da42ac08e'
            '735808619bb3f40ea10746aabb2bdea275c7f2c8a00cfeb5d765fcca1c834adb'
            '66b7706fa9e94a9c2907eefe84a1560b081f5aeea624b73a43043d4a2e817ea9'
            '8aa9def1b2b1abf0ef3a3095daf11fafd9557d9221b2ff57e52465b24a83812d'
            '37a083be091532f379dfdcea441ca3e3a3f4aa30e3d8dcf958fe18134219d5b0'
            'e412defa7489e5855318ca77bee67382b7d6997276d0a70321c9fe3c762647e4'
            'f4d1d418d91b1619688a482680ee032ffd2b65e420c6d2eaecf8aa3762aa64c8'
            '096cdd18e26b2b3d8cf0b3ec6a1ffb5b0eaae0fcc2105e3c145f19037a42d467')

build() {
  cd "${srcdir}"

  cabextract -F '*.tt[fc]' -d 'win7_sp1' 'windows6.1-KB976932-X64.exe'
  find 'win7_sp1' -name '*.tt[fc]' -exec cp '{}' . \;

  # cambria.ttc is a TrueType Collection (TTC) which causes problems with
  # LibreOffice (Cambria Reguar cannot be selected) so we need to convert
  # the TTC into a TrueType Font (TTF).
  FONTFORGE_LANGUAGE=ff fontforge -c 'Open("cambria.ttc(Cambria)"); Generate("cambria.ttf")'

  for zip in *.zip; do
    unzip -o "$zip"
  done
  convmv --lower --notest *.TTF

  tar -xf 'ttf-microsoft-consolas.tar.xz'
}

package() {
  cd "${srcdir}"

  fontdir="${pkgdir}/usr/share/fonts/TTF"

  install -d -m 755 "${fontdir}"

  install -m 644 *.ttf "${fontdir}"
  install -m 644 ttf-microsoft-consolas/*.ttf "${fontdir}"
  install -D -m 644 "license.rtf" "${pkgdir}/usr/share/licenses/${pkgname}/license.rtf"
}

# vim: set ts=2 sw=2 ft=sh noet:
